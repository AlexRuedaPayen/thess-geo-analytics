mode: "dev"  # allowed: "dev", "deep"

project:
  name: "thess-geo-analytics"

# ----------------------------------
# Global pipeline controls
# ----------------------------------
pipeline:
  # Single temporal knob used across the pipeline
  # (BuildSceneCatalog, BuildAssetsManifest, etc.)
  date_start: "2021-01-01"

region:
  name: "Thessaloniki"

aoi:
  id: "el522"
  file: "EL522_Thessaloniki.geojson"

tables:
  scene_catalog: "scenes_s2_all.csv"
  scenes_selected: "scenes_selected.csv"
  assets_manifest: "assets_manifest_selected.csv"
  ndvi_period_stats: "ndvi_period_stats.csv"

# ----------------------------------
# Scene Catalog (BuildSceneCatalog)
# ----------------------------------
scene_catalog:
  # No date_start here anymore; use pipeline.date_start in code

  cloud_cover_max: 20.0
  max_items: 3000
  collection: "sentinel-2-l2a"
  use_tile_selector: true
  full_cover_threshold: 0.95
  allow_union: true
  n_anchors: 64
  window_days: 42
  max_union_tiles: 20
  out_table: "scenes_s2_all.csv"

# ----------------------------------
# Assets Manifest (BuildAssetsManifest)
# ----------------------------------
assets_manifest:
  scenes_selected_table: "scenes_selected.csv"
  out_table: "assets_manifest_selected.csv"

  max_scenes: null
  sort_mode: "cloud_then_time"

  download_n: 999999
  upload_to_gcs: false

  gcs_bucket: "thess-geo-analytics"
  gcs_prefix: "raw_s2"
  delete_local_after_upload: false
  raw_storage_mode: "url_to_local"

  band_resolution: 10

# ----------------------------------
# Timestamps aggregation (BuildAggregatedTimestamps)
# ----------------------------------

timestamps_aggregation:
  # parallelism
  max_workers: 6        # you can tweak; dev mode is small-ish so 4â€“8 is reasonable
  debug: false          # true = sequential + full tracebacks; false = parallel

  # TileAggregator knobs
  merge_method: "first"
  resampling: "nearest"

  # nodata choice:
  # - 0.0 keeps uint16 S2 bands and uses 0 as nodata (standard for S2)
  # - or, if you *really* want NaN, you can set nodata: .nan and keep promote_to_float_if_needed=True
  nodata: 0.0

  # bands to aggregate
  bands: ["B04", "B08", "SCL"]

# ----------------------------------
# NDVI Monthly / Quarterly Composites
# ----------------------------------
ndvi_monthly_composite:
  aoi_file: "EL522_Thessaloniki.geojson"
  aoi_id: "el522"

  time_serie_table: "scenes_selected.csv"
  assets_manifest_table: "assets_manifest_selected.csv"

  max_scenes_per_period: null
  min_scenes_per_month: 2
  fallback_to_quarterly: true
  download_missing: true
  verbose: false

  raw_storage_mode: "url_to_local"
  gcs_bucket: "thess-geo-analytics"
  gcs_prefix_raw: "raw_s2"

  upload_composites_to_gcs: false
  gcs_prefix_composites: "ndvi/composites"


# ----------------------------------
# Upload defaults (GCS; non-secret)
# ----------------------------------
upload:
  composites:
    bucket: "thess-geo-analytics"
    remote_prefix: "ndvi/composites"

  pixel_features:
    bucket: "thess-geo-analytics"
    remote_prefix: "ndvi/pixel_features"